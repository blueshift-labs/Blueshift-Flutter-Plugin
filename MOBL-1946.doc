<!DOCTYPE html>
<html>
<head>
    <title>[#MOBL-1946] optimalprint.com - flutter android issues</title>
    <meta http-equiv="Content-Type" Content="application/vnd.ms-word; charset=UTF-8">
        <style type="text/css">

.tableBorder, .grid
{
    background-color: #fff;
    width: 100%;
    border-collapse: collapse;
}

.tableBorder td, .grid td
{
    vertical-align: top;
    padding: 2px;
    border: 1px solid #ccc;
}

.noPadding
{
    padding: 0 !important;
}

h3 .subText
{
    font-size: 60%;
    font-weight: normal;
}

.tabLabel
{
    font-weight: bold;
    border: 1px solid #ccc;
    border-bottom:none;
    padding: 2px;
    display: inline;
}

td.blank
{
    padding: 0;
    margin: 0;
}

.blank td
{
    border: none;
}

#descriptionArea
{
    margin: 0;
    padding: 2px;
    border: 1px solid #ccc;
}

hr
{
    border-top:1px solid #aaa;
}

hr.fullcontent
{
  height: 15px;
  padding: 10px 0;
  background: #fff url('https://blueshift.atlassian.net/images/icons/hr.gif') no-repeat scroll center;
}

</style>

</head>
<body>

<table class="tableBorder" cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
        <td bgcolor="#f0f0f0" width="100%" colspan="2" valign="top">
                            <h3 class="formtitle">
                        [MOBL-1946]&nbsp;<a href="https://blueshift.atlassian.net/browse/MOBL-1946">optimalprint.com - flutter android issues</a>
            <span class="subText">
               Created: 18/Feb/26                   &nbsp;Updated: 19/Feb/26

                                            </span>
            </h3>
        </td>
    </tr>
    <tr>
        <td width="20%"><b>Status:</b></td>
        <td width="80%">To Do</td>
    </tr>
    <tr>
        <td width="20%"><b>Project:</b></td>
        <td width="80%"><a href="https://blueshift.atlassian.net/secure/BrowseProject.jspa?id=10021">mobile</a></td>
    </tr>

        <tr>
            <td><b>Components:</b></td>
            <td>
                            None
                </td>
    </tr>
    

        <tr>
            <td><b>Affects versions:</b></td>
            <td>
                            None
                </td>
    </tr>
    

        <tr>
            <td><b>Fix versions:</b></td>
            <td>
                            None
                </td>
    </tr>
    
    
    </table>

<br />
<table class="grid" cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
        <td bgcolor="#f0f0f0" valign="top" width="20%">
            <b>Type:</b>
        </td>
        <td bgcolor="#ffffff" valign="top"  width="30%" >
            Support Issue
        </td>

                    <td bgcolor="#f0f0f0">
                <b>Priority:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" nowrap>
                Medium
            </td>
            </tr>
    <tr>
                        <td bgcolor="#f0f0f0" valign="top" width="20%">
                <b>Reporter:</b>
            </td>
            <td bgcolor="#ffffff" valign="top"  width="30%" >
                                        
                
        
            <a class="user-hover" rel="621d0be359c0740069d6ae20"
                id="word_reporter_621d0be359c0740069d6ae20"
                href="https://blueshift.atlassian.net/secure/ViewProfile.jspa?accountId=621d0be359c0740069d6ae20">
                    Eric Callahan
                </a>

                            </td>
        
                    <td bgcolor="#f0f0f0" width="20%">
                <b>Assignee:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" nowrap  width="30%" >
                                        
                
        
            <a class="user-hover" rel="712020:74a2b194-44d7-4bdc-8990-ff91d548f40d"
                id="word_assignee_712020:74a2b194-44d7-4bdc-8990-ff91d548f40d"
                href="https://blueshift.atlassian.net/secure/ViewProfile.jspa?accountId=712020%3A74a2b194-44d7-4bdc-8990-ff91d548f40d">
                    Sudhanshu Kumar
                </a>

                            </td>
            </tr>
    	<tr>
		<td bgcolor="#f0f0f0" width="20%">
			<b>Resolution:</b>
		</td>
		<td bgcolor="#ffffff" valign="top" width="30%" nowrap>
            				Unresolved
                    </td>
                    <td bgcolor="#f0f0f0" width="20%">
                <b>Votes:</b>
            </td>
            <td bgcolor="#ffffff" valign="top" width="30%" nowrap>
                0
            </td>
        
    </tr>
    
        <tr>
        <td bgcolor="#f0f0f0" width="20%">
            <b>Labels:</b>
        </td>
        <td id="labels-83661-value" class="value" bgcolor="#ffffff" valign="top" colspan="3" nowrap>
                            jira_escalated, optimalprint.com, support_incident                    </td>
    </tr>
    
    	<tr>
        		<td bgcolor="#f0f0f0" width="20%"><b>Remaining Estimate:</b></td>
        <td bgcolor="#ffffff" valign="top" nowrap width="80%" colspan="3">
                            Not Specified
            		</td>
    </tr>
    <tr>
                <td bgcolor="#f0f0f0" width="20%"><b>Time Spent:</b></td>
		<td bgcolor="#ffffff" valign="top" nowrap width="80%" colspan="3">
                            Not Specified
            		</td>
	</tr>
    <tr>
                <td bgcolor="#f0f0f0" width="20%"><b>Original estimate:</b></td>
		<td bgcolor="#ffffff" valign="top" nowrap width="80%" colspan="3">
                            Not Specified
            		</td>
    </tr>
    
    </table>



    <br />

    	<table class="grid" cellpadding="0" cellspacing="0" border="0" width="100%">
            

        
    


    
                        <tr>
                <td bgcolor="#f0f0f0" width="20%" valign="top"><b>Rank:</b></td>
                <td id="customfield_10019-83661-value" class="value" bgcolor="#ffffff" width="80%">      2|hzw9ex:2r
  </td>
            </tr>
                                <tr>
                <td bgcolor="#f0f0f0" width="20%" valign="top"><b>Account:</b></td>
                <td id="customfield_10314-83661-value" class="value" bgcolor="#ffffff" width="80%">    optimalprint.com</td>
            </tr>
            </table>

    <br/>

    <table cellpadding="2" cellspacing="0" border="0" width="100%" align="center">
    <tr>
        <td bgcolor="#bbbbbb" width="1%" nowrap align="center">
            &nbsp;<font color="#ffffff"><b>Description</b></font>&nbsp;
        </td>
        <td>&nbsp;</td>
    </tr>
    </table>

    <table cellpadding="0" cellspacing="0" border="0" width="100%">
    <tr>
        <td id="descriptionArea">
            <p>account: optimalprint.com<br/>
task: customer seeing numerous issues with integrating with android using flutter. </p>

<p>We are integrating the Blueshift Flutter plugin (<tt>blueshift_plugin: ^1.2.0</tt> from <a href="http://pub.dev/" class="external-link" rel="nofollow noreferrer">pub.dev</a>) into our production e-commerce app (Optimalprint — 25 countries, ~500k users). iOS seems to work fine, but on Android we're hitting several critical issues that make the plugin unusable.</p>

<h2><a name="1.AllAndroiddevicesshow%22Uninstalled%22onBlueshiftdashboard"></a>1. All Android devices show "Uninstalled" on Blueshift dashboard</h2>

<p>Every Android user of our new flutter app is marked as <tt>app_status: Uninstalled</tt> on the Blueshift dashboard, despite the SDK initializing correctly and all events being sent and acknowledged with HTTP 200. Push notifications cannot be delivered.</p>

<p><b>What we've done (following your documentation exactly):</b></p>

<ul>
	<li>SDK auto-initializes from AndroidManifest meta-data (all keys correct, see config below)</li>
	<li>We call <tt>Blueshift.registerForInAppMessage('Flutter')</tt> — confirmed working in logcat:</li>
</ul>


<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>D/Blueshift: InAppManager: UNREGISTER { screen: com.gelato.Optimalprint.MainActivity, activity: ... }
D/Blueshift: InAppManager: REGISTER { screen: Flutter, activity: ... }
</pre>
</div></div>

<ul>
	<li>We call <tt>Blueshift.handlePushNotification(message.data)</tt> for foreground and background messages</li>
	<li>We listen on <tt>Blueshift.getInstance.onDeepLinkReceived</tt> for deep links</li>
	<li>We listen on <tt>Blueshift.getInstance.oniOSPushNotificationClick</tt> for iOS push payloads</li>
	<li>We call <tt>Blueshift.requestPushNotificationPermission()</tt> when requesting permissions</li>
	<li>We call <tt>Blueshift.getInitialUrl</tt> on Android cold start</li>
	<li>We call <tt>getToken()</tt> before <tt>FirebaseMessaging.onBackgroundMessage</tt> (per your docs)</li>
	<li>We fire a manual <tt>app_open</tt> event (since auto app_open doesn't fire — see below)</li>
</ul>


<p><b>All events succeed with HTTP 200. Here is the full</b> <tt>app_open</tt> <b>event from logcat:</b></p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>I/Blueshift: BlueshiftHttpManager: {
  "api":"https://api.getblueshift.com/api/v1/event",
  "method":"POST",
  "body":{
    "enable_push":true,
    "firstname":"Przemysław",
    "app_version":"11.1.8 (110018)",
    "device_id":"fHSfeOCXSxm16qGwBQzdf4:com.gelato.Optimalprint",
    "firebase_instance_id":"fHSfeOCXSxm16qGwBQzdf4",
    "advertising_id":"10b46d36-e0aa-4244-a8d1-60bdd71a3987",
    "device_type":"android",
    "network_carrier":"Play",
    "limit_ad_tracking":false,
    "enable_inapp":true,
    "device_manufacturer":"samsung",
    "bsft_sdk_version":"3.5.1-FL-1.2.0",
    "lastname":"kłosek",
    "app_name":"com.gelato.Optimalprint",
    "country_code":"US",
    "language_code":"en",
    "device_token":"fHSfeOCXSxm16qGwBQzdf4:APA91bGcnL-xIGEd5-EYEOyEQ_baYSCrWPdVB6VnszANsGzU0M_vBo4bbqv7zVBleDn6eU09ZF37IxpDLG-8405XLDXfTBnL_LdKdHCqUEzlQu_Ghykg4kM",
    "os_name":"Android 16",
    "event":"app_open",
    "customer_id":"64985343",
    "email":"przemyslaw.klosek+op4@gmail.com",
    "timestamp":"2026-02-18T19:54:55.176000Z"
  }
}
I/Blueshift: BlueshiftHttpManager: {"status":200,"response":{"status":"ok"}}
</pre>
</div></div>

<p><b>The</b> <tt>identify</tt> <b>event also succeeds with the same device_token and enable_push:true.</b></p>

<p><b>In-app message fetch also succeeds:</b></p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>I/Blueshift: BlueshiftHttpManager: {
  "api":"https://api.getblueshift.com/inapp/msg",
  "method":"POST",
  "body":{
    "customer_id":"64985343",
    "email":"...",
    "enable_inapp":true,
    "enable_push":true,
    "device_token":"fHSfeOCXSxm16qGwBQzdf4:APA91bGcnL-...",
    ...
  }
}
I/Blueshift: BlueshiftHttpManager: {"status":200,"response":{"content":[]}}
</pre>
</div></div>

<p><b>Despite all events returning 200 OK with correct payloads (device_token, enable_push, customer_id, email), the dashboard still shows "Uninstalled".</b></p>

<h3><a name="Whyauto%7B%7Bappopen%7D%7Ddoesn%27tfire"></a>Why auto <tt>app_open</tt> doesn't fire</h3>

<p>The Flutter plugin initializes the native SDK with <tt>applicationContext</tt> (in <tt>BlueshiftFlutterRegistrar.initSdk()</tt>, line 183) before the Activity is attached. The <tt>ENABLE_AUTO_APP_OPEN</tt> config defaults to <tt>true</tt>, but the automatic <tt>app_open</tt> event never fires.</p>

<p>We tried fire <tt>app_open</tt> manually via <tt>Blueshift.trackCustomEvent('app_open', {}, false)</tt>, which calls <tt>Blueshift.trackEvent("app_open", ...)</tt> on the native side. We suspect this may not be treated the same as the internal <tt>Blueshift.trackAppOpen()</tt> method that the auto app_open uses. The Flutter plugin does not expose a <tt>trackAppOpen()</tt> method — only <tt>trackCustomEvent()</tt>.</p>

<p><b>Question: Does the dashboard require the</b> <tt>app_open</tt> <b>event to come specifically from the internal</b> <tt>trackAppOpen()</tt> <b>method rather than</b> <tt>trackEvent("app_open", ...)</tt><b>? If so, could you expose</b> <tt>trackAppOpen()</tt> <b>in the Flutter plugin?</b></p>

<h2><a name="2.20Androidmethodchannelcallsneverinvoke%7B%7Bresult.success%28%29%7D%7D"></a>2. ~20 Android method channel calls never invoke <tt>result.success()</tt></h2>

<p>In <tt>BlueshiftFlutterPlugin.java</tt>, the following methods execute the native Blueshift SDK call correctly but <b>never call</b> <tt>result.success()</tt> on the MethodChannel <tt>Result</tt> object. This causes every <tt>await</tt> in Dart to hang indefinitely:</p>

<p><b>Affected methods (none call</b> <tt>result.success()</tt><b>):</b></p>

<p><tt>identifyWithDetails()</tt> <tt>Blueshift.identifyUser()</tt> <tt>trackCustomEvent()</tt> <tt>Blueshift.trackEvent()trackScreenView()</tt> <tt>Blueshift.trackScreenView()</tt> <tt>setUserInfoEmailId()</tt> <tt>result.success()</tt> <tt>setUserInfoCustomerId()</tt> and others.</p>



<p><b>Note:</b> The <tt>Result</tt> object isn't even passed to most of these methods — it's accepted in <tt>onMethodCall()</tt> but only forwarded to getter methods (like <tt>getEnablePushStatus</tt>, <tt>getUserInfoFirstName</tt>, etc.). The setter/action methods simply ignore it.</p>

<p><b>Impact:</b> Any Flutter app using <tt>await Blueshift.identifyWithDetails(...)</tt> or <tt>await Blueshift.trackCustomEvent(...)</tt> on Android will hang the calling async function forever. The native code executes correctly — the events are sent — but the Flutter side never gets a response.</p>

<h2><a name="3.Bugin%7B%7BBlueshiftFlutterRegistrar.java%7D%7D%E2%80%94wrongconditionalgates"></a>3. Bug in <tt>BlueshiftFlutterRegistrar.java</tt> — wrong conditional gates</h2>

<p>In <tt>BlueshiftFlutterRegistrar.initSdk()</tt>, several configuration options are incorrectly gated by <tt>inAppIntervalSeconds &gt; 0</tt> instead of their own value checks:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>// Line 97: inAppIntervalSeconds is read here
long inAppIntervalSeconds = metaData.getInt(IN_APP_INTERVAL, 0);

// Line 101: BATCH_INTERVAL gated by inAppIntervalSeconds (should be batchIntervalSeconds &gt; 0)
if (inAppIntervalSeconds &gt; 0) config.setBatchInterval(batchIntervalSeconds * 1000L);

// Line 103-104: NOTIFICATION_ICON_SMALL gated by inAppIntervalSeconds (should be notificationIconSmall &gt; 0)
if (inAppIntervalSeconds &gt; 0) config.setSmallIconResId(notificationIconSmall);

// Line 107: NOTIFICATION_ICON_BIG gated by inAppIntervalSeconds (should be notificationIconBig &gt; 0)
// Also calls setSmallIconResId instead of setLargeIconResId — copy-paste bug
if (inAppIntervalSeconds &gt; 0) config.setSmallIconResId(notificationIconBig);

// Line 110: NOTIFICATION_ICON_COLOR also gated by inAppIntervalSeconds
if (inAppIntervalSeconds &gt; 0) { ... config.setNotificationColor(color); }
</pre>
</div></div>

<p><b>Impact:</b> If you don't set <tt>IN_APP_INTERVAL</tt> in your AndroidManifest (and the default is 0), then <tt>NOTIFICATION_ICON_SMALL</tt>, <tt>NOTIFICATION_ICON_BIG</tt>, <tt>NOTIFICATION_ICON_COLOR</tt>, and <tt>BATCH_INTERVAL</tt> are silently ignored — regardless of what values you set. Additionally, <tt>NOTIFICATION_ICON_BIG</tt> calls <tt>setSmallIconResId()</tt> instead of the large icon setter.</p>

<h2><a name="OurFullConfiguration"></a>Our Full Configuration</h2>

<p><b>Flutter plugin:</b> <tt>blueshift_plugin: ^1.2.0</tt> (latest on <a href="http://pub.dev/" class="external-link" rel="nofollow noreferrer">pub.dev</a>)</p>

<p><b>Native SDK version:</b> 3.5.1 (bundled with plugin)</p>

<p><b>Flutter version:</b> 3.38.5</p>

<p><b>Tested on:</b> Samsung Galaxy S24 (Android 16), also reproduced on Android 14</p>

<p><b>AndroidManifest.xml Blueshift config:</b></p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>&lt;meta-data android:name="com.blueshift.config.API_KEY" android:value="@string/blueshift_api_key" /&gt;
&lt;meta-data android:name="com.blueshift.config.ENABLE_PUSH" android:value="true" /&gt;
&lt;meta-data android:name="com.blueshift.config.ENABLE_IN_APP" android:value="true" /&gt;
&lt;meta-data android:name="com.blueshift.config.ENABLE_IN_APP_JS" android:value="true" /&gt;
&lt;meta-data android:name="com.blueshift.config.IN_APP_ON_ALL_SCREENS" android:value="true" /&gt;
&lt;meta-data android:name="com.blueshift.config.DEVICE_ID_SOURCE" android:value="INSTANCE_ID_PKG_NAME" /&gt;
&lt;meta-data android:name="com.blueshift.config.NOTIFICATION_ICON_SMALL" android:resource="@mipmap/ic_launcher" /&gt;
&lt;meta-data android:name="com.blueshift.config.NOTIFICATION_ICON_BIG" android:resource="@mipmap/ic_launcher" /&gt;
&lt;meta-data android:name="com.blueshift.config.APP_ICON" android:resource="@mipmap/ic_launcher" /&gt;
</pre>
</div></div>

<p><b>Dart initialization flow:</b></p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>// 1. Firebase.initializeApp()
// 2. BlueshiftService.initialize():
//    - Blueshift.registerForInAppMessage('Flutter')  ← works, but hangs without our workaround (bug #2)
//    - Blueshift.trackCustomEvent('app_open', {}, false) ← sent, 200 OK, but dashboard ignores it
// 3. FirebaseMessaging.instance.getToken()
// 4. FirebaseMessaging.onBackgroundMessage(handler)
// 5. FirebaseMessaging.onMessage → Blueshift.handlePushNotification(message.data)
// 6. Blueshift.getInstance.onDeepLinkReceived.listen(...)
// 7. Blueshift.getInstance.oniOSPushNotificationClick.listen(...)
// 8. After login — identifyUser:
//    - Blueshift.setUserInfoCustomerId(customerId)  ← hangs without workaround (bug #2)
//    - Blueshift.setUserInfoEmailId(email)           ← hangs without workaround (bug #2)
//    - Blueshift.identifyWithDetails(userInfo)       ← hangs without workaround (bug #2), but event sent OK
// 9. Blueshift.setEnablePush(true) + identifyWithDetails({})
</pre>
</div></div>

<h2><a name="WhatWeNeed"></a>What We Need</h2>

<ol>
	<li><b>Bug</b> <a href="https://blueshiftsuccess.zendesk.com/agent/tickets/1" class="external-link" rel="nofollow noreferrer"><b>#1</b></a> <b>(Uninstalled status)</b> — please investigate why the dashboard shows "Uninstalled" despite <tt>app_open</tt> and <tt>identify</tt> events being received with 200 OK, with <tt>device_token</tt> and <tt>enable_push: true</tt> present. Is <tt>trackCustomEvent('app_open')</tt> not equivalent to the internal <tt>trackAppOpen()</tt>? If so, please expose <tt>trackAppOpen()</tt> in the Flutter plugin.</li>
	<li><b>Bug</b> <a href="https://blueshiftsuccess.zendesk.com/agent/tickets/2" class="external-link" rel="nofollow noreferrer"><b>#2</b></a> <b>(method channel hangs)</b> — please add <tt>result.success(null)</tt> to all setter/action methods in <tt>BlueshiftFlutterPlugin.java</tt>. This is a one-line fix per method and would unblock every Flutter developer using the plugin on Android.</li>
	<li><b>Bug</b> <a href="https://blueshiftsuccess.zendesk.com/agent/tickets/3" class="external-link" rel="nofollow noreferrer"><b>#3</b></a> <b>(wrong conditional gates)</b> — please fix the conditional gates in <tt>BlueshiftFlutterRegistrar.java</tt> and the <tt>setSmallIconResId</tt> copy-paste error for the big icon.</li>
	<li><b>Timeline</b> — could you provide an estimated timeline for a patch release? We are blocked on Android push notifications for our production app launch.</li>
</ol>

            <br/>
        </td>
    </tr>
    </table>

Generated at Thu Feb 19 05:47:05 UTC 2026 by Sudhanshu Kumar using Jira 1001.0.0-SNAPSHOT#100290-rev:f972029f0275a0b149382000daba964c7858cccc.

</body>
</html>