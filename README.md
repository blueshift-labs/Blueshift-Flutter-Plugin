# blueshift-flutter-plugin

Flutter plugin for Blueshift iOS and Android SDK.

## Installation

```sh
fluter pub get blueshift-flutter-plugin
```

## Android and iOS Integration
Refer to the below documents to integrate the Blueshift SDK for Android and iOS.

- [Android SDK Integation](Android.md)
- [iOS SDK Integation](iOS.md)


## Usage
Import the Blueshift plugin in your dart file as mentioned below to use its functionality.

```js
import 'package:blueshift_flutter_plugin/blueshift.dart';
```

Once imported, you can call the Blueshift methods as mentioned below.

```js
// Make a call to Blueshift functions
BlueshiftFlutterPlugin.setUserInfoEmailId("test@blueshift.com");
BlueshiftFlutterPlugin.identifyWithDetails({
  "user_type":"premium",
  "country": "US",
  "timezone":"PST"
  });
```

Refer to [these Blueshift Dart methods](lib/blueshift.dart) to know about features and methods supported by Plugin and how to use them. 

### Setting user info

Using the Plugin, you can set the logged-in user info in the Blueshift SDK. SDK will add this user data to each event and send it to the Blueshift server. This user data can be saved when the user logs in to the app and needs to be removed once the user logs out of the app.

In order to associate the events to the correct user, there are three primary identifiers used to identify a user uniquely.

- DeviceID - This will be auto-generated by SDK and sent to the Blueshift server as the `device_id` attribute as part of every event. 
- EmailId - Email id needs to be set whenever it changes as mentioned in the below code snippet and this will be sent to the Blueshift server as part of every event.
- CustomerId - Customer id needs to be set whenever it changes as mentioned in the below code snippet and this will be sent to the Blueshift server as part of every event.

```js
// Set data on successful login 
BlueshiftFlutterPlugin.setUserInfoEmailId("test@blueshift.com");
BlueshiftFlutterPlugin.setUserInfoCustomerId("cust123456");

// Set other user info as below. This info will be used for creating 
// segments or running personalized campaigns 
BlueshiftFlutterPlugin.setUserInfoFirstName("John");
BlueshiftFlutterPlugin.setUserInfoLastName("Cartor");
BlueshiftFlutterPlugin.setUserInfoExtras({
  "profession":"software engineer", 
  "isLoggedIn":true
  });
```

Clear the stored user information at the time of logout.
```js
BlueshiftFlutterPlugin.removeUserInfo();

```
Make sure you fire an `identify` event after making changes to the user data to update it on the Blueshift server.  

### Identify event
`Identify` event is responsible to update the data for the user profile on the Blueshift server. Whenever you change any user data in the Blueshift SDK, we recommend you fire an identify event to reflect those changes on the Blueshift server. This ensures that we can still attribute the events to the user and generate recommendations for the user if the `device_id` resets due to the app uninstall.

```javascript
// Set user data at login
BlueshiftFlutterPlugin.setUserInfoEmailId("test@blueshift.com");
BlueshiftFlutterPlugin.setUserInfoCustomerId("cust123456");
BlueshiftFlutterPlugin.setUserInfoExtras({
  "profession":"software engineer", 
  "isLoggedIn":true
  });

// Identify event with custom data
BlueshiftFlutterPlugin.identifyWithDetails({
  "user_type":"premium",
  "country": "US",
  "timezone":"PST"
  });
```

### Custom Event
Use the below method to track custom events with custom data in your app.

```javascript
BlueshiftFlutterPlugin.trackCustomEvent("name_of_event", {}, false);
```

### Push and in-app notification opt-out
- **Push notifications opt-out**

Use Blueshift app preferences to opt-out of push notifications that we send from our platform. You can use it if you don't want push notifications from our platform to show up on your device. After modifying the value, fire an identify event to update the data on the Blueshift server.

```javascript
// set the preference for push notification
BlueshiftFlutterPlugin.setEnablePush(false);

// fire identify event
BlueshiftFlutterPlugin.identifyWithDetails({});
```
- **In-app notifications opt-out**

Use Blueshift app preferences to opt-out of In-app notifications that we send from our platform. You can use it if you don't want in-app notifications from our platform to show up on your device. After modifying the value, fire an identify event to update the data on the Blueshift server.

```javascript
// set the preference for push notification
BlueshiftFlutterPlugin.setEnableInApp((false);

// fire identify event
BlueshiftFlutterPlugin.identifyWithDetails({});
```

### Delay Push permission dialog(iOS only)
Blueshift SDK registers for iOS push notifications automatically after the app launch. If you don't want the push notification permission to be displayed immediately on the app launch, you can customize it to display it later after sign up/sign in. To do that you need to set the `config.enablePushNotification` as `false` in your **Xcode project** while initializing the Blueshift Plugin.

```Objective-c
// Disable push notifications in the SDK configuration 
// to delay the Push notification permission dialog
[config setEnablePushNotification:NO];

```

You can invoke the below plugin method from your **Flutter code** when you want to register for push notifications and show the push notification dialog to the user.

```javascript
// Register for remote notifications using SDK. 
// Calling this method will show push permission dialogue to the user.
BlueshiftFlutterPlugin.registerForRemoteNotification();

```
## In-App Notifications
Once you enable the in-app notifications from the SDK as mentioned in the Android and iOS set-up documents, you will need to register the screens in order to see in-app messages. You can register the screens in two ways.

- **Register all screens** Refer to [Android](Android.md#in-app-messages) and [iOS](iOS.md#3-enable-in-app-messages) integration documents to register all screens to receive in-app notifications. After completing this set up, in-app can be displayed on any screen when it is availble to display.

- **Register and unregister each screen** of your Flutter project for in-app messages. If you donâ€™t register a screen for in-app messages, the in-app messages will stop showing up for screens that are not registered. You will need to add in-app registration and unregistration code on the `componentDidMount` and `componentWillUnmount` respectively inside your screens. Refer below code snipper for reference. 

```Javascript
 componentDidMount() { 
    // Register for in-app notification
    BlueshiftFlutterPlugin.registerForInAppMessage("HomeScreen");
  }
  
 componentWillUnmount() {
    // Unregister for in-app notification
    BlueshiftFlutterPlugin.unregisterForInAppMessage();
 }
```

## Deep links Event Listener

### Deep links for Push notification, In-app notification and email
Blueshift Plugin will take care of delivering the deep link added inside the Push and in-app notifications to the Flutter once the user interacts with the notification.

Blueshift plugin will also take care of handling the Email deep links. Email deep links are basically App links for Android and Universal links for iOS. To enable the App links and Universal links you need to set them up as mentioned in the Android and iOS integration document.

Blueshift plugin will deliver the deep link to Flutter using the event stream. You will need to add a listener as mentioned below in your project to receive the deep link.

```javascript
  // Add event listner for `url` event
   BlueshiftFlutterPlugin.getInstance.onDeepLinkReceived.listen(String deeplink) {
      print(" deep link received " + deeplink);
    });
```

## License

MIT
